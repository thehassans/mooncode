# FINAL WORKING VERSION
# Uses Plesk's Node.js and installs pm2 if needed

# Set up paths
export PATH="/opt/plesk/node/24/bin:$PATH"

# Install pm2 globally if not already installed (one-time setup)
npm list -g pm2 || npm install -g pm2

# Backend deployment
cd backend && npm ci --production && pm2 restart mooncode-backend || pm2 start src/index.js --name mooncode-backend

# Frontend deployment
cd ../frontend && npm ci && npm run build

echo "âœ… Deployment complete at $(date)"
